openapi: 3.0.3
info:
  title: Asset Management API
  description: |
    Enterprise Asset Management Backend API with DDD Architecture.
    
    ## Authentication
    All protected endpoints require a Bearer token in the Authorization header.
    ```
    Authorization: Bearer <token>
    ```
    
    ## Rate Limiting
    API calls are rate-limited to 100 requests per minute per user.
    
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.example.com
    description: Production server

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Assets
    description: Asset management
  - name: Maintenance
    description: Maintenance and work orders
  - name: Loans
    description: Asset loan management
  - name: Sensors
    description: IoT sensor data
  - name: RBAC
    description: Role-based access control
  - name: Notifications
    description: User notifications
  - name: Dashboard
    description: Analytics and statistics

paths:
  /health:
    get:
      summary: Health check
      tags: [Health]
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  version:
                    type: string
                    example: 1.0.0

  /api/auth/login:
    post:
      summary: User login
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/UserInfo'

  /api/assets:
    get:
      summary: List assets
      tags: [Assets]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/per_page'
      responses:
        '200':
          description: List of assets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedAssets'
    post:
      summary: Create asset
      tags: [Assets]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAssetRequest'
      responses:
        '201':
          description: Asset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

  /api/assets/{id}:
    get:
      summary: Get asset by ID
      tags: [Assets]
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/id'
      responses:
        '200':
          description: Asset details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'
        '404':
          description: Asset not found

  /api/work-orders:
    get:
      summary: List work orders
      tags: [Maintenance]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of work orders
    post:
      summary: Create work order
      tags: [Maintenance]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkOrderRequest'
      responses:
        '201':
          description: Work order created

  /api/loans:
    get:
      summary: List loans
      tags: [Loans]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of loans
    post:
      summary: Create loan request
      tags: [Loans]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLoanRequest'
      responses:
        '201':
          description: Loan request created

  /api/dashboard/stats:
    get:
      summary: Get dashboard statistics
      tags: [Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dashboard statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardStats'

  /api/sensors/alerts:
    get:
      summary: List active sensor alerts
      tags: [Sensors]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of active alerts

  /api/rbac/roles:
    get:
      summary: List all roles
      tags: [RBAC]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of roles

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    id:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid
    page:
      name: page
      in: query
      schema:
        type: integer
        default: 1
    per_page:
      name: per_page
      in: query
      schema:
        type: integer
        default: 20
        maximum: 100

  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
        data:
          type: object

    UserInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        name:
          type: string
        role:
          type: string

    Asset:
      type: object
      properties:
        id:
          type: string
          format: uuid
        asset_code:
          type: string
        name:
          type: string
        category_id:
          type: string
          format: uuid
        status:
          type: string
        purchase_price:
          type: number
        created_at:
          type: string
          format: date-time

    CreateAssetRequest:
      type: object
      required: [asset_code, name, category_id]
      properties:
        asset_code:
          type: string
        name:
          type: string
        category_id:
          type: string
          format: uuid
        location_id:
          type: string
          format: uuid
        purchase_price:
          type: number

    CreateWorkOrderRequest:
      type: object
      required: [asset_id, wo_type]
      properties:
        asset_id:
          type: string
          format: uuid
        wo_type:
          type: string
          enum: [preventive, corrective, predictive]
        priority:
          type: string
          enum: [low, medium, high, critical]
        problem_description:
          type: string

    CreateLoanRequest:
      type: object
      required: [asset_id, borrower_id, loan_date, expected_return_date]
      properties:
        asset_id:
          type: string
          format: uuid
        borrower_id:
          type: string
          format: uuid
        loan_date:
          type: string
          format: date
        expected_return_date:
          type: string
          format: date

    PaginatedAssets:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Asset'
        pagination:
          $ref: '#/components/schemas/Pagination'

    Pagination:
      type: object
      properties:
        total:
          type: integer
        page:
          type: integer
        per_page:
          type: integer
        total_pages:
          type: integer

    DashboardStats:
      type: object
      properties:
        assets:
          type: object
          properties:
            total:
              type: integer
            total_value:
              type: number
        maintenance:
          type: object
          properties:
            pending:
              type: integer
            overdue:
              type: integer
        loans:
          type: object
          properties:
            active:
              type: integer
            overdue:
              type: integer
        alerts:
          type: object
          properties:
            active:
              type: integer
            critical:
              type: integer
